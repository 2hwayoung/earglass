{% extends "./partials/layout.html" %}
{% block body %}

<!-- form 제출로 묶어서 Task 추가되도록 설정해야함 -->

<h1>ADD Task</h1>
</br>
</br>
<form id="app">
    <!-- TODO add task handling -->
    <div class="form-group">
<<<<<<< HEAD
        <label class="form-group col-md-2">TaskName</label>
        <input id="taskname" name="taskname" type="text" class="form-group col-md-2" name="task_name" placeholder="taskname">
    </div>
    <div class="form-group">
        <label class="form-group col-md-2">Description</label>
        <textarea id="task_description" style="margin-left:15px;"cols="30" rows="10" class="form-control" name="task_description" placeholder="description"></textarea>
    </div>
    <div class="form-group">
        <label class="form-group col-md-2">최소 업로드 주기</label>
        <input id="period" type="text" class="form-group col-md-2" name="period" placeholder="0"> week
    </div>
    <div class="form-group">
        <label class="form-group col-md-2">테이블 이름</label>
        <input id="table_name" type="text" class="form-group col-md-2" name="table_name" placeholder="table_name">
    </div>
    <div class="form-group">
        <label class="form-group col-md-2">기본 데이터 타입</label>
        <input type="text" style="width:100%" class="form-group col-md-2" placeholder="기본 필드 이름" v-model="defaultFieldBuffer">
        <button type="button" id="default-field-add-button" v-on:click="addDefaultField()">추가하기</button>
        <ul id="default-field-list">
            <li v-for="field in defaultFields">
                [[ field ]]
            </li>
        </ul>
    </div>
    <div class="form-group">
        <label for="" class="form-group col-md-2">스키마</label>
        <textarea class="form-control textarea" name="schema" placeholder="(ex: field1:"></textarea>
=======
        <label>TaskName</label>
        <input type="text" class="form-control">
    </div>
    <div class="form-group">
        <label>기본 데이터 타입</label>
        <div class="form-row">
            <div class="form-group">
                <input type="text" class="form-control" placeholder="기본 필드 이름" v-model="defaultFieldBuffer">
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-primary" v-on:click="addDefaultField()">추가하기</button>
            </div>
        </div>
>>>>>>> 85f0a42616bb1fa8e36347cdefee55183f6a544b
    </div>
    <div class="form-group">
        <label>원본 데이터 타입</label>
        <div class="form-row">
            <div class="form-group">
                <input type="text" class="form-control" placeholder="원본 데이터 타입 이름" v-model="originDataTypeBuffer">
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-primary" v-on:click="addOriginDataType()">추가하기</button>
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="card mb-2" v-for="(dataType, dataTypeName) in originDataTypes">
            <div class="card-body">
                <div class="card-title">
                    <div class="form-row">
                        <h6 class="col">[[ dataTypeName ]]</h6>
                        <!-- delete origin data type -->
                        <button class="btn btn-danger" type="button"
                            v-on:click="deleteOriginDataType(dataTypeName)">x</button>
                    </div>
                </div>
                <div class="card-text">
                    <template v-for="(defaultField, subField) in dataType">
                        <li class="form-row mb-2">
                            <span class="col mr-1">[[ subField ]]</span>
                            <select class="form-control col mr-1">
                                <template v-for="originDefaultField in defaultFields">
                                    <option v-if="originDefaultField == defaultField" value="originDefaultField"
                                        selected>
                                        [[ originDefaultField ]]
                                    </option>
                                    <option v-if="originDefaultField != defaultField" value="originDefaultField">
                                        [[ originDefaultField ]]
                                    </option>
                                </template>
                            </select>
                            <button class="btn btn-danger" type="button" v-on:click="deleteSubField(dataTypeName, subField)">x</button>
                            <!-- delete subField -->
                        </li>
                    </template>
                    <li class="form-row">
                        <input type="text" class="col form-control mr-1" v-model="subFieldBuffer[dataTypeName]">
                        <select class="form-control col mr-1">
                            <template v-for="originDefaultField in defaultFields">
                                <option value="originDefaultField">
                                    [[ originDefaultField ]]
                                </option>
                            </template>
                        </select>
                        <button class="btn btn-success" type="button" v-on:click="addSubField(dataTypeName)">+</button>
                        <!-- add subField -->
                    </li>
                </div>
            </div>
        </div>
    </div>
    <h5 style="margin-left: 15px; margin-bottom: 10px;"><b>시스템 Pass 기준 설정</b></h5>
    <div class="form-group">
        <label class="form-group col-md-3">최대 중복 Tuple 비율</label>
        <input id="tuple_ratio" type="text" class="form-group col-md-2" name="tuple_ratio" placeholder="0">%
    </div>
    <div class="form-group">
        <label class="form-group col-md-3">최대 Column별 Null 비율</label>
        <input id="null_ratio" type="text" class="form-group col-md-2" name="null_ratio" placeholder="0">%
    </div>
    <div class="form-group">
<<<<<<< HEAD
        <label class="form-group col-md-4"><h5><b>평가자 정성평가 Pass 기준설명</b></h5></label>
        <textarea id="pass_criteria_description" style="margin-left: 15px;"cols="30" rows="10" class="form-control" name="pass_criteria_description" placeholder="description"></textarea>
=======
        <label class="form-group col-md-4">
            <h5><b>평가자 정성평가 Pass 기준설명</b></h5>
        </label>
        <textarea style="margin-left: 15px;" cols="30" rows="10" class="form-control" name="pass_criteria_description"
            placeholder="description"></textarea>
>>>>>>> 85f0a42616bb1fa8e36347cdefee55183f6a544b
    </div>
    </br>
    <button type="submit" class="btn btn-primary float-right mb-4">Task 생성</button>
</form>
<script>
    const app = new Vue({
        el: "form#app",
        data: {
            // form fields
            taskName: '',
            description: '',
            minPeriod: '',
            tableName: '',
            defaultFields: [
                'defaultField1', 'defaultField2'
            ], // li this.
            defaultFieldBuffer: '',
            originDataTypes: {
                // dataTypeName: { subField1: defaultField1, subField2L: defaultField2}
                dataType1: { subField1: 'defaultField1', subField2: 'defaultField2' },
                dataType2: { subField3: 'defaultField1', subField4: 'defaultField2' }
            },
            originDataTypeBuffer: '',
            subFieldBuffer: {
                
            }
        },
        methods: {
            addDefaultField() {
                if (!this.defaultFieldBuffer) {
                    alert("빈칸을 채워주세요")
                } else if (this.defaultFields.includes(this.defaultFieldBuffer)) {
                    alert("이미 존재하는 기본 필드입니다");
                } else {
                    this.defaultFields.push(this.defaultFieldBuffer);
                    this.defaultFieldBuffer = '';
                }
            },
            addOriginDataType() {
                if (!this.originDataTypeBuffer) {
                    alert("빈칸을 채워주세요")
                } else if (Object.keys(this.originDataTypes).includes(this.originDataTypeBuffer)) {
                    alert("이미 존재하는 원본 데이터 타입입니다");
                } else {
                    this.originDataTypes[this.originDataTypeBuffer] = {};
                    this.originDataTypeBuffer = '';
                }
            },
            addSubField(dataTypeName) {
                if (!this.subFieldBuffer[dataTypeName]) {
                    alert("빈칸을 채워주세요")
                } else {
                    console.log(this.subFieldBuffer[dataTypeName]);
                    // this.subFieldBuffer[dataTypeName] = '';
                }
            },
            deleteOriginDataType(dataTypeName) {
                Vue.delete(this.originDataTypes, dataTypeName);
            },
            deleteSubField(dataTypeName, subField) {
                Vue.delete(this.originDataTypes[dataTypeName], subField)
            },
            validateSchema() {
                for (let dataTypeName in this.originDataTypes) {
                    const originDataType = this.originDataTypes[dataTypeName]
                    const defaultFields = Object.entries(originDataType)
                    for (let defaultField of defaultFields) {
                        if (!defaultFields.includes(defaultField)) {
                            return false;
                        }
                    }
                }
                return true;
            }
        },
        delimiters: ['[[', ']]']
    })
</script>
{% endblock %}